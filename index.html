<!DOCTYPE html>
<span style="color: #FF2400">â¬¨</span>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>AKM Dashboard</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
        <link rel="stylesheet" href="styles.css">
        <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:; frame-src *; child-src *; worker-src *; frame-ancestors *;">
    </head>

    <body>
        <nav class="fixed top-0 right-0 w-full bg-transparent z-50 p-2 md:p-4" style="background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(10px);">
            <div class="container mx-auto flex items-center justify-between flex-wrap gap-2">
                <!-- Title for Desktop -->
                <h1 class="hidden md:block text-white text-2xl font-bold mr-4">AKM EndGame Dapp</h1>
                <!-- Balance Boxes -->
                <div class="flex flex-wrap items-center gap-2 md:gap-4">
                    <div class="balance-box-nav">
                        <div class="balance-label-nav">AKM</div>
                        <div class="balance-value">0.00</div>
                    </div>
                    <div class="balance-box-nav">
                        <div class="balance-label-nav">RETH</div>
                        <div class="balance-value">0.00</div>
                    </div>
                    <div class="balance-box-nav">
                        <div class="balance-label-nav">USD</div>
                        <div class="balance-value">$0.00</div>
                    </div>
                </div>
                <!-- Connect Wallet Button -->
                <!-- Connect Wallet and Add Token Buttons -->
<div class="flex gap-2">
    <button 
        id="connectWallet" 
        class="bg-[#FF2400] hover:bg-[#ff4d33] text-white font-bold py-1 px-2 md:py-2 md:px-4 rounded-lg transition-colors text-xs md:text-base"
    >
        Connect Wallet
    </button>
    <button 
    id="addToken" 
    class="bg-[#FF2400] hover:bg-[#ff4d33] text-white font-bold py-1 px-2 md:py-2 md:px-4 rounded-lg transition-colors text-xs md:text-base"
>
    Add AKM
</button>
</div>
        </nav>
        <h1 class="md:hidden" style="font-size: 2.25rem; text-align: center; margin: 7rem 0 2rem 0; color: white; font-weight: bold; text-shadow: 0 0 10px rgba(255,36,0,0.3);">
            AKM EndGame Dapp
        </h1>
    
    
        <div class="header-container">
            <div class="header-image">
                <img src="./images/level2.gif" alt="AKM Ethereum Ninja Scene" class="top-image">
            </div>
            <div style="text-align: center;">
                <img id="rsiGif" class="rsi-gif" alt="Loading Milie Indicator...">
                <div style="margin-top: 10px; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                    Buy Signal
                    <span class="info-icon" title="1 ETH shining: Consider waiting to buy AKM. 2 ETH shining: Neutral market conditions. 3 ETH shining with red-eyed Milie: Potentially good time to buy AKM">i</span>
                </div>
                <a href="https://swap.defillama.com/?chain=arbitrum&from=0x287c48a78395f6fa4ac7f71a5e92dc65256f570f" 
                class="milie-button"
                >
                 Buy AKM [Temporary]
             </a>
            </div>
        </div>
        <div class="flex justify-center">
            <div class="flex flex-col md:flex-row gap-4 w-full max-w-4xl">
                <!-- Deposit Box -->
                <div class="flex-1 bg-[#1e1e1e] p-5 rounded-lg border border-[#2a2a2a]">
                    <div class="text-white text-xl font-bold mb-4" style="display: flex; align-items: center; gap: 10px;">
                        USD Yield+Rewards (Coming Soon)
                        <span class="info-icon" title="Deposit USD to earn yield and RETH token rewards from liquidations. No lockup period required">i</span>
                    </div>
                    
                    <!-- Auto Invest Toggle -->
                    <div style="text-align: right; margin-bottom: 10px;">
                        <button id="autoInvestToggle" class="auto-invest-toggle" onclick="toggleAutoInvest()">
                            Auto Invest Reward OFF
                        </button>
                    </div>
        
                    <div class="deposit-header">
                        <div class="toggle-buttons">
                            <button class="toggle-button active" onclick="toggleAction('deposit')">Deposit</button>
                            <button class="toggle-button" onclick="toggleAction('withdraw')">Withdraw</button>
                            <button class="toggle-button" onclick="claimRewards()">Claim Rewards</button>
                        </div>
                    </div>
        
                    <input type="number" class="amount-input" value="0.00" min="0" step="0.01">
                    
                    <div class="apy-display">
                        <span>Amount: <span id="apyValue">0</span>%</span>
                        <span>Max: 100%</span>
                    </div>
                    
                    <input 
                        type="range" 
                        id="apySlider" 
                        class="apy-slider" 
                        min="0" 
                        max="100" 
                        value="0"
                        oninput="updateAPY(this.value)"
                    >
        
                    <button class="w-full bg-[#FF2400] hover:bg-[#ff4d33] text-white font-bold py-3 rounded-lg mt-4 transition-colors">
                        Deposit
                    </button>
        
                    <div class="pool-share">
                        Pool share: 0% 
                        <span class="info-icon" title="Percentage of your USD deposit compared to the total deposited in this pool.">i</span>
                    </div>
                </div>
                
                
                <!-- DEXTswap Widget -->
<div class="flex-1 bg-[#1e1e1e] p-5 rounded-lg border border-[#2a2a2a]">
    <div class="text-white text-xl font-bold mb-4 flex items-center gap-2">
        Buy and Sell AKM for anycoin
        <span class="info-icon" title="Trade between different assets with DextSwap">i</span>
    </div>
    
    <div class="dextswap-container">
        <iframe 
            id="dextswap-aggregator-widget"
            title="DEXTools Aggregator"
            src="https://www.dextools.io/widget-aggregator/en/swap/arbitrum/0x287c48a78395f6fa4ac7f71a5e92dc65256f570f?theme=dark"
            frameborder="0"
            allow="clipboard-write"
            loading="lazy"
            importance="high"
            style="border-radius: 8px;"
        ></iframe>
    </div>
</div>
            </div>
        </div>
        <div class="container">
            <h1 class="flex items-center justify-center gap-2 text-xl text-white mb-4">
                AKM Price Today
                <span class="info-icon" title="Current live USD price per AKM token in the market">i</span>
            </h1>
            
            <div class="flex flex-col items-center gap-2 price-container">
                <div id="tokenPrice" class="value">Loading...</div>
                
                <!-- ATH Display -->
                <div class="ath-display">
                    All Time High: <span id="athPrice">(price loading)</span>
                    <span id="athDate" class="ml-2"></span>
                </div>
                
                <div id="priceChange" class="performance"></div>
            </div>
        </div>
    
    <div class="container">
        <h2 style="display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 1.25rem; color: white;">
            Token Supply Remaining
            <span class="info-icon" style="margin-top: 5px;" title="Total existing AKM tokens. This number continuously decreases as tokens are burned, and no new tokens can be created">i</span>
        </h2>
        <div class="value" id="tokenSupply">Loading...</div>
        <div id="supplyInfo"></div>
        <div id="burnedAmount"></div>
    </div>
    
    <div class="container">
        <h2 style="display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 1.25rem; color: white;">
            AKM/ETH Performance (1Y)
            <span class="info-icon" style="margin-top: 5px;" title="Additional return percentage if you had invested in AKM instead of ETH one year ago">i</span>
        </h2>
        <div id="performance" class="performance">Loading...</div>
    </div>
    
    <div class="container">
        <h2 style="display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 1.25rem; color: white;">
            Top 13 AKM Holders
            <span class="info-icon" style="margin-top: 5px;" title="The 13 largest AKM holders, aka Gotei 13 who have special privileges as project co-runners">i</span>
        </h2>
        <div class="holders-buttons">
            <button class="milie-button" onclick="toggleHoldersList()">Click to view list</button>
        </div>
        <div id="holdersList" style="display: none;">
            <table class="ranking-table hidden-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Holder</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody id="rankingTableBody"></tbody>
            </table>
        </div>
    </div>

    <div id="imageModal" class="modal">
        <img class="modal-content modal-img" id="modalImg">
    </div>
    <div class="container roadmap-container">
        <h2 style="display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 1.25rem; color: white;">
            AKM Roadmap
            <span class="info-icon" style="margin-top: 5px;" title="Expected timeline for the project's goals and milestones">i</span>
        </h2>
        <button class="milie-button" onclick="toggleRoadmap()">Click to view roadmap</button>
        <div id="roadmapContent" style="display: none;">
            <div class="pdf-container">
                <embed id="roadmapImage" src="./images/roadmap.pdf" class="roadmap-pdf" type="application/pdf">
            </div>
        </div>
    </div>
    <script>
        const RSI_UPDATE_INTERVAL = 60000; // Update every 1 minute
// Cache variables
let rsiCache = {
    value: null,
    timestamp: 0
};
let ethPriceCache = {
    value: null,
    timestamp: 0
};
const CACHE_DURATION = 5 * 60 * 1000; // 5 minutes cache

// Cache helper function
function isCacheValid(cache) {
    return cache.timestamp && (Date.now() - cache.timestamp < CACHE_DURATION);
}
    
        
        const RSI_GIF_HIGH = "https://s7.gifyu.com/images/SXr0D.gif";
        const RSI_GIF_VERY_HIGH = "https://s13.gifyu.com/images/SXnzh.gif";
        const RSI_GIF_LOW = "https://s7.gifyu.com/images/SXr0o.gif";
    
        // UI Interaction Functions
        function toggleAction(action) {
            const buttons = document.querySelectorAll('.toggle-button');
            buttons.forEach(button => {
                button.classList.remove('active');
                if(button.textContent.toLowerCase() === action) {
                    button.classList.add('active');
                }
            });
            document.getElementById('actionTitle').textContent = 
                action.charAt(0).toUpperCase() + action.slice(1);
        }
    
        function toggleHoldersList() {
    const holdersList = document.getElementById('holdersList');
    const toggleButton = document.querySelector('.container .milie-button');
    
    if (!holdersList || !toggleButton) return;
    
    if (holdersList.style.display === 'none' || holdersList.style.display === '') {
        holdersList.style.display = 'block';
        holdersList.classList.add('visible');
        toggleButton.textContent = 'Hide list';
        loadHolders();
    } else {
        holdersList.style.display = 'none';
        holdersList.classList.remove('visible');
        toggleButton.textContent = 'Click to view list';
    }
}
    
function toggleRoadmap() {
    const roadmapContent = document.getElementById('roadmapContent');
    const button = document.querySelector('.roadmap-container button');
    
    if (roadmapContent.style.display === 'none' || roadmapContent.style.display === '') {
        roadmapContent.style.display = 'block';
        button.textContent = 'Hide roadmap';
    } else {
        roadmapContent.style.display = 'none';
        button.textContent = 'Click to view roadmap';
    }
}
    
        function claimRewards() {
            console.log('Claim rewards clicked');
        }
    
        
    
        // API and Data Functions
        async function getRSI() {
    try {
        // Check cache first
        if (isCacheValid(rsiCache)) {
            console.log('Using cached RSI value');
            return rsiCache.value;
        }

        console.log('Fetching fresh RSI data from Binance...');
        const PERIODS = 14;
        
        // Get 4h candlesticks from Binance
        const response = await fetch('https://api.binance.com/api/v3/klines?symbol=ETHUSDT&interval=4h&limit=100');
        
        if (!response.ok) {
            throw new Error(`Binance API HTTP error! status: ${response.status}`);
        }
        
        const klineData = await response.json();

        // Validate data
        if (!Array.isArray(klineData) || klineData.length < PERIODS + 1) {
            throw new Error('Insufficient data points for RSI calculation');
        }

        // Extract closing prices (index 4 in Binance kline data)
        const prices = klineData
            .map(candle => parseFloat(candle[4]))
            .filter(price => !isNaN(price));

        // Calculate price changes
        const changes = [];
        for (let i = 1; i < prices.length; i++) {
            changes.push(prices[i] - prices[i - 1]);
        }

        // Separate gains and losses
        const gains = changes.map(change => change > 0 ? change : 0);
        const losses = changes.map(change => change < 0 ? Math.abs(change) : 0);

        // Calculate initial averages
        let avgGain = gains.slice(0, PERIODS).reduce((sum, gain) => sum + gain, 0) / PERIODS;
        let avgLoss = losses.slice(0, PERIODS).reduce((sum, loss) => sum + loss, 0) / PERIODS;

        // Calculate smoothed averages
        for (let i = PERIODS; i < gains.length; i++) {
            avgGain = ((avgGain * 13) + gains[i]) / PERIODS;
            avgLoss = ((avgLoss * 13) + losses[i]) / PERIODS;
        }

        // Calculate RSI
        const rs = avgLoss === 0 ? 100 : avgGain / avgLoss;
        const rsiValue = 100 - (100 / (1 + rs));

        // Update cache
        rsiCache.value = rsiValue;
        rsiCache.timestamp = Date.now();

        console.log('Calculated RSI:', rsiValue);
        return rsiValue;
    } catch (error) {
        console.error('Error calculating RSI:', error);
        return null;
    }
}
    
async function updateRSIGif() {
    try {
        const rsi = await getRSI();
        const gifElement = document.getElementById('rsiGif');
        
        if (!gifElement) return;

        if (rsi === null) {
            console.error('RSI calculation failed');
            gifElement.src = RSI_GIF_LOW; // Default to LOW in case of error
            return;
        }

        console.log('Updating GIF for RSI:', rsi);
        
        if (rsi >= 60) {
            gifElement.src = RSI_GIF_VERY_HIGH;
            console.log('RSI is very high (â¥60) - Potentially good time to hodl');
        } else if (rsi >= 35) {
            gifElement.src = RSI_GIF_HIGH;
            console.log('RSI is moderate (35-60) - Normal market conditions');
        } else {
            gifElement.src = RSI_GIF_LOW;
            console.log('RSI is low (<35) - Consider waiting');
        }
    } catch (error) {
        console.error('Error updating RSI GIF:', error);
        const gifElement = document.getElementById('rsiGif');
        if (gifElement) {
            gifElement.src = RSI_GIF_LOW;
        }
    }
}
    
        async function fetchAKMPrice() {
            try {
                const response = await fetch('https://api.dexscreener.com/latest/dex/pairs/arbitrum/0xd9ecf7fb6c8356f1c42ef44b15b61c88625401be');
                const data = await response.json();
                return data.pairs?.[0]?.priceUsd ? Number(data.pairs[0].priceUsd) : 0;
            } catch (error) {
                console.error('Error fetching AKM price:', error);
                return 0;
            }
        }
    
        function calculateUSDValue(akmAmount) {
            return (akmAmount * currentPrice).toLocaleString(undefined, {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }
    
        function getOrdinal(n) {
            const s = ["th", "st", "nd", "rd"];
            const v = n % 100;
            return s[(v - 20) % 10] || s[v] || s[0];
        }
    
        async function loadHolders() {
    try {
        currentPrice = await fetchAKMPrice();
        const timestamp = new Date().getTime();
        const response = await fetch(`holders.json?t=${timestamp}`);
        
        if (!response.ok) {
            throw new Error('Failed to fetch holders data');
        }
        
        const holders = await response.json();
        const tableBody = document.getElementById('rankingTableBody');
        
        if (!tableBody) return;
        
        tableBody.innerHTML = '';

        holders.forEach((holder, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="rank-number">${index + 1}${getOrdinal(index + 1)}</td>
                <td class="holder-cell">
                    <div class="holder-container">
                        <img src="${holder.image}?t=${timestamp}" alt="${holder.name}" class="holder-image" onclick="openModal(this.src)">
                        <div class="holder-info">
                            <div class="holder-name">${holder.name}</div>
                        </div>
                    </div>
                </td>
                <td class="amount-cell">
                    <div class="holder-amount">${holder.amount.toLocaleString()} AKM</div>
                    <div class="holder-amount">($${calculateUSDValue(holder.amount)})</div>
                </td>
            `;
            tableBody.appendChild(row);
        });
    } catch (error) {
        console.error('Error loading holders:', error);
        const tableBody = document.getElementById('rankingTableBody');
        if (tableBody) {
            tableBody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: red;">Error loading holders data. Please try again.</td></tr>';
        }
    }
}
    
        function openModal(src) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImg');
            modal.style.display = "block";
            modalImg.src = src;
        }
    
        async function updateData() {
    try {
        const priceResponse = await fetch('https://api.dexscreener.com/latest/dex/pairs/arbitrum/0xd9ecf7fb6c8356f1c42ef44b15b61c88625401be');
        const priceData = await priceResponse.json();
        
        if (priceData.pairs?.[0]) {
            const price = priceData.pairs[0].priceUsd;
            currentPrice = Number(price);
            
            // Add null checks for all DOM elements
            const tokenPriceEl = document.getElementById('tokenPrice');
            const priceChangeEl = document.getElementById('priceChange');
            const performanceEl = document.getElementById('performance');
            const tokenSupplyEl = document.getElementById('tokenSupply');
            const supplyInfoEl = document.getElementById('supplyInfo');
            const burnedAmountEl = document.getElementById('burnedAmount');
            
            if (tokenPriceEl) tokenPriceEl.textContent = `$${Number(price).toFixed(2)}`;
            
            const initialPrice = 0.10;
            const priceChange = ((currentPrice - initialPrice) / initialPrice) * 100;
            
            if (priceChangeEl) {
                priceChangeEl.textContent = `${priceChange > 0 ? '+' : ''}${priceChange.toFixed(1)}% (Since Launch)`;
                priceChangeEl.className = `performance ${priceChange >= 0 ? 'positive' : 'negative'}`;
            }

            // Continue with the rest of your code, adding null checks
            const performanceValue = await getPerformanceData();
            if (performanceValue !== null && performanceEl) {
                performanceEl.textContent = `${performanceValue >= 0 ? '+' : ''}${performanceValue.toFixed(2)}% vs ETH (1Y)`;
                performanceEl.className = `performance ${performanceValue >= 0 ? 'positive' : 'negative'}`;
            }

            const totalSupply = 1000000;
            const burnedAmount = 434980;
            const circulatingSupply = totalSupply - burnedAmount;
                
            if (tokenSupplyEl) tokenSupplyEl.textContent = `${circulatingSupply.toLocaleString()} AKM`;
            if (supplyInfoEl) supplyInfoEl.textContent = `Total Supply Created Originally: ${totalSupply.toLocaleString()} AKM`;
            if (burnedAmountEl) {
                burnedAmountEl.innerHTML = `
                    <div class="burned-amount-container">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#FF2400" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: -1px;">
                            <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/>
                        </svg>
                        Burned: ${burnedAmount.toLocaleString()} AKM
                    </div>
                `;
            }
        }
    } catch (error) {
        console.error('Error:', error);
    }
}
    
        
        async function getPerformanceData() {
    try {
        console.log('Calculating performance data...');
        
        // Get current AKM price (keeping existing code)
        const akmResponse = await fetch('https://api.dexscreener.com/latest/dex/pairs/arbitrum/0xd9ecf7fb6c8356f1c42ef44b15b61c88625401be');
        const akmData = await akmResponse.json();
        const currentAkmPrice = Number(akmData.pairs?.[0]?.priceUsd) || 0;
        
        // Get historical ETH price (1 year ago)
        const oneYearAgo = Date.now() - (365 * 24 * 60 * 60 * 1000);
        const historicalResponse = await fetch(
            `https://api.binance.com/api/v3/klines?symbol=ETHUSDT&interval=1d&startTime=${oneYearAgo}&limit=1`
        );
        
        if (!historicalResponse.ok) {
            throw new Error('Failed to fetch historical ETH price');
        }
        
        const historicalData = await historicalResponse.json();
        
        // Get current ETH price
        const currentResponse = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=ETHUSDT');
        const currentData = await currentResponse.json();
        
        if (!currentData?.price || !Array.isArray(historicalData) || !historicalData[0]) {
            throw new Error('Invalid price data');
        }

        const oldEthPrice = parseFloat(historicalData[0][4]); // Close price
        const currentEthPrice = parseFloat(currentData.price);

        // Calculate returns
        const ethReturn = ((currentEthPrice - oldEthPrice) / oldEthPrice) * 100;
        const akmReturn = ((currentAkmPrice - 0.10) / 0.10) * 100; // Using initial AKM price of $0.10

        const performanceDiff = akmReturn - ethReturn;
        console.log('Performance calculation:', {
            ethReturn,
            akmReturn,
            performanceDiff
        });

        return performanceDiff;
    } catch (error) {
        console.error('Error calculating performance:', error);
        return null;
    }
}
    
        // Modal click handler
        window.onclick = function(event) {
            const modal = document.getElementById('imageModal');
            if (event.target === modal || event.target.classList.contains('modal-img')) {
                modal.style.display = "none";
            }
        };
    
        // Initialize
        updateData();
        updateRSIGif();
    
        // Set intervals for updates
        setInterval(updateData, 30000);
        setInterval(updateRSIGif, RSI_UPDATE_INTERVAL);
    // Add these new functions for the APY slider and Auto Invest toggle
    function updateAPY(value) {
        document.getElementById('apyValue').textContent = value;
        const slider = document.getElementById('apySlider');
        const percentage = (value / slider.max) * 100;
        slider.style.background = `linear-gradient(to right, #FF2400 0%, #FF2400 ${percentage}%, #2a2a2a ${percentage}%, #2a2a2a 100%)`;
    }

    function toggleAutoInvest() {
        const button = document.getElementById('autoInvestToggle');
        const isActive = button.classList.contains('active');
        if (isActive) {
            button.classList.remove('active');
            button.textContent = 'Auto Invest Reward OFF';
        } else {
            button.classList.add('active');
            button.textContent = 'Auto Invest Reward ON';
        }
    }
    function startHoldersAutoRefresh() {
    setInterval(() => {
        const holdersList = document.getElementById('holdersList');
        if (holdersList && holdersList.style.display !== 'none') {
            loadHolders();
        }
    }, 30000);
}
    </script>


    
    <!-- Web3 Integration -->
<!-- Web3 Integration -->

<script src="web3-security.js"></script>
<script>
    let initializationAttempts = 0;
    const maxAttempts = 10;

    function initializeWeb3() {
        try {
            initializationAttempts++;
            
            // Check if ethers is loaded
            if (typeof ethers === 'undefined') {
                if (initializationAttempts < maxAttempts) {
                    console.log(`Attempt ${initializationAttempts}: Ethers.js not loaded yet, retrying in 1 second...`);
                    setTimeout(initializeWeb3, 1000);
                } else {
                    console.error('Failed to load Ethers.js after multiple attempts. Please refresh the page.');
                }
                return;
            }

            console.log('Ethers.js loaded successfully!');
            
            // Initialize Web3 Security
            const web3Security = new Web3Security();

            // Connect wallet button
            const connectButton = document.getElementById('connectWallet');
            if (connectButton) {
                connectButton.onclick = async () => {
                    try {
                        if (typeof window.ethereum === 'undefined') {
                            throw new Error('MetaMask is not installed. Please install MetaMask to continue.');
                        }
                        
                        const address = await web3Security.connectWallet();
                        // Update button text to show connected address
                        connectButton.textContent = `${address.slice(0, 6)}...${address.slice(-4)}`;
                    } catch (error) {
                        console.error('Wallet connection error:', error);
                        alert('Failed to connect wallet: ' + error.message);
                    }
                };
            }
        } catch (error) {
            console.error('Initialization error:', error);
        }
    }
    function startHoldersAutoRefresh() {
    setInterval(() => {
        const holdersList = document.getElementById('holdersList');
        if (holdersList && holdersList.style.display !== 'none') {
            loadHolders();
        }
    }, 30000);
}

// Add this line to your DOMContentLoaded event
document.addEventListener('DOMContentLoaded', function() {
    initializeWeb3();
    startHoldersAutoRefresh(); // Add this line
});
    // Start initialization when the page loads
    document.addEventListener('DOMContentLoaded', function() {
        initializeWeb3();
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Create social buttons container
        const socialButtons = document.getElementById('social-buttons');
        
        // Create buttons HTML
        const buttonsHTML = `
            <a href="https://t.me/+B9PHTaCwSQ03YWU0" target="_blank" rel="noopener noreferrer" class="social-button">
                <img src="https://cdn.jsdelivr.net/npm/@tabler/icons@2.47.0/icons/brand-telegram.svg" alt="Telegram" />
            </a>
            <a href="https://x.com/akm_project_" target="_blank" rel="noopener noreferrer" class="social-button">
                <img src="https://cdn.jsdelivr.net/npm/@tabler/icons@2.47.0/icons/brand-x.svg" alt="X (Twitter)" />
            </a>
            <a href="https://github.com/gogoneriel/AKM" target="_blank" rel="noopener noreferrer" class="social-button">
                <img src="https://cdn.jsdelivr.net/npm/@tabler/icons@2.47.0/icons/brand-github.svg" alt="GitHub" />
            </a>
            <button onclick="openWhitepaper()" class="social-button">
                <img src="https://cdn.jsdelivr.net/npm/@tabler/icons@2.47.0/icons/file-text.svg" alt="Whitepaper" />
            </button>
        `;
        
        socialButtons.innerHTML = buttonsHTML;
    
        // Create whitepaper modal
        const modalHTML = `
    <div id="whitepaper-modal" class="whitepaper-modal">
        <div class="whitepaper-content">
            <button onclick="closeWhitepaper()" class="close-button">Ã</button>
            <h2 style="font-size: 1.5rem; margin-bottom: 1rem;">AKM Project White Paper</h2>
            <div style="line-height: 1.6;">
                <p style="margin: 0.5rem 0">The AKM Project is a pioneering initiative rooted in Ethereum maximalism, libertarianism, and entrepreneurship. It aims to create a self-sustaining, decentralized ecosystem where community members can thrive economically and ideologically through the use of smart contracts, DeFi, and AI.</p>

                <h3 style="font-size: 1.2rem; margin-top: 1rem;">Introduction</h3>
                <p style="margin: 0.5rem 0">The AKM Project seeks to revolutionize how individuals interact with finance and governance, leveraging Ethereum's blockchain for security and immutability. By promoting libertarian ethics, the project encourages a community where innovation, personal freedom, and mutual prosperity are paramount.</p>

                <h3 style="font-size: 1.2rem; margin-top: 1rem;">Project Overview</h3>
                
                <h4 style="font-size: 1.1rem; margin-top: 0.8rem;">Core Philosophy</h4>
                <ul style="margin-left: 1.5rem; list-style-type: disc;">
                    <li>Ethereum Maximalism: Utilizing Ethereum for its proven security, decentralization, and smart contract capabilities.</li>
                    <li>Libertarianism: Advocating for minimal governance and maximum individual freedom within the project's community.</li>
                    <li>Entrepreneurship: Fostering an environment where new business ideas can be incubated using blockchain technology and AI.</li>
                </ul>

                <h4 style="font-size: 1.1rem; margin-top: 0.8rem;">Token Details</h4>
                <ul style="margin-left: 1.5rem; list-style-type: none;">
                    <li>Token Name: AKM</li>
                    <li>Token Address: 0x287c48a78395f6fa4ac7f71a5e92dc65256f570f</li>
                    <li>Circulating Supply: 565,020 AKM</li>
                    <li>Total Supply: 1,000,000 AKM</li>
                    <li>Burned: 434,980 AKM</li>
                </ul>

                <h3 style="font-size: 1.2rem; margin-top: 1rem;">Financial Structure</h3>
                <p style="margin: 0.5rem 0">Decentralized Ecosystem: The AKM Project exclusively uses the most decentralized and Ethereum-aligned projects:</p>
                <ul style="margin-left: 1.5rem; list-style-type: disc;">
                    <li>Uniswap V3: For all token exchanges, ensuring liquidity in the decentralized way.</li>
                    <li>RETH: For pairing with AKM in liquidity pools, supporting Ethereum's staking ecosystem.</li>
                    <li>Nerite RETH Stability Pool: To provide USD yield and rewards.</li>
                    <li>WarChest: An allocation of cryptocurrencies for managing project expenses and funding future AKM investments.</li>
                </ul>

                <h3 style="font-size: 1.2rem; margin-top: 1rem;">Tokenomics and Distribution</h3>
                <p style="margin: 0.5rem 0">Initial distribution included 10% allocated to the team and 10% to seed investors at $0.10 per AKM. The top 5 holders control 65% of circulating supply, with a 10-year vesting schedule implementation planned (2 years lock-up + 8 years linear vesting).</p>

                <h3 style="font-size: 1.2rem; margin-top: 1rem;">AI Integration - Milie Series</h3>
                <ul style="margin-left: 1.5rem; list-style-type: disc;">
                    <li>Milie: AI chatbot with market indicators</li>
                    <li>Vitalic: AI for advocacy and fundraising</li>
                    <li>Vitalic V2: AI bot for DeFi arbitrage</li>
                </ul>

                <h3 style="font-size: 1.2rem; margin-top: 1rem;">Business Incubation</h3>
                <p style="margin: 0.5rem 0">10% of profits from incubated businesses are used to buy back and burn AKM tokens as indicated by Milie.</p>

                <h3 style="font-size: 1.2rem; margin-top: 1rem;">Additional Notes</h3>
                <p style="margin: 0.5rem 0">Future fund utilization: 20% to WarChest and 80% to add liquidity on Uniswap.</p>

                <h3 style="font-size: 1.2rem; margin-top: 1rem;">Core Values</h3>
                <p style="margin: 0.5rem 0">Ethics: Emphasizing libertarian principles, promoting self-governance, and financial freedom through technology.</p>
            </div>
        </div>
    </div>
`;
        
        document.body.insertAdjacentHTML('beforeend', modalHTML);
    });
    
    function openWhitepaper() {
        document.getElementById('whitepaper-modal').style.display = 'block';
    }
    
    function closeWhitepaper() {
        document.getElementById('whitepaper-modal').style.display = 'none';
    }
    
    // Close modal when clicking outside
    document.addEventListener('click', function(event) {
        const modal = document.getElementById('whitepaper-modal');
        if (event.target === modal) {
            closeWhitepaper();
        }
    });
    document.getElementById('addToken').onclick = async () => {
    try {
        if (typeof window.ethereum === 'undefined') {
            alert('Please install MetaMask first!');
            return;
        }

        await window.ethereum.request({
            method: 'wallet_watchAsset',
            params: {
                type: 'ERC20',
                options: {
                    address: '0x287c48a78395f6fa4ac7f71a5e92dc65256f570f',
                    symbol: 'AKM',
                    decimals: 18,
                }
            }
        });
    } catch (error) {
        console.error(error);
        alert('Error adding token to MetaMask');
    }
};
    </script>
<div id="social-buttons"></div>
<script>
    let ath = {
        price: 0,
        date: null
    };
    
    async function updatePriceAndATH() {
        try {
            const response = await fetch('https://api.dexscreener.com/latest/dex/pairs/arbitrum/0xd9ecf7fb6c8356f1c42ef44b15b61c88625401be');
            const data = await response.json();
            
            if (data.pairs?.[0]) {
                const currentPrice = Number(data.pairs[0].priceUsd);
                
                // Update current price
                const tokenPriceEl = document.getElementById('tokenPrice');
                if (tokenPriceEl) {
                    tokenPriceEl.textContent = `$${currentPrice.toFixed(2)}`;
                }
                
                // Check and update ATH
                if (currentPrice > ath.price) {
                    ath.price = currentPrice;
                    ath.date = new Date();
                    
                    // Save to localStorage
                    localStorage.setItem('akm_ath', JSON.stringify(ath));
                }
                
                // Update ATH display
                const athPriceEl = document.getElementById('athPrice');
                const athDateEl = document.getElementById('athDate');
                if (athPriceEl) {
                    athPriceEl.textContent = `$${ath.price.toFixed(2)}`;
                }
                if (athDateEl && ath.date) {
                    athDateEl.textContent = `(${new Date(ath.date).toLocaleDateString()})`;
                }
                
                // Calculate and update price change
                const initialPrice = 0.10;
                const priceChange = ((currentPrice - initialPrice) / initialPrice) * 100;
                const priceChangeEl = document.getElementById('priceChange');
                if (priceChangeEl) {
                    priceChangeEl.textContent = `${priceChange > 0 ? '+' : ''}${priceChange.toFixed(1)}% (Since Launch)`;
                    priceChangeEl.className = `performance ${priceChange >= 0 ? 'positive' : 'negative'}`;
                }
            }
        } catch (error) {
            console.error('Error updating price:', error);
        }
    }
    
    // Load saved ATH from localStorage
    const savedATH = localStorage.getItem('akm_ath');
    if (savedATH) {
        ath = JSON.parse(savedATH);
    }
    
    // Initial update
    updatePriceAndATH();
    
    // Update every 30 seconds
    setInterval(updatePriceAndATH, 30000);
    </script>
<script async type='module' src='https://interfaces.zapier.com/assets/web-components/zapier-interfaces/zapier-interfaces.esm.js'></script>
<zapier-interfaces-chatbot-embed is-popup='true' chatbot-id='cm5v649pl000j5pc83jltmwfs'></zapier-interfaces-chatbot-embed>
<!-- Replace the existing script with this -->
</body>
</html>